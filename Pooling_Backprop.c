#include <stdio.h>

void Pooling_Backprop(double a_c[][2][2][2], int stride, double a_p[][2][1][1], double dz_o[][2][1], int K, int channel, double dz_p[][2][2][2]) {
    int i, j, k, l;
    double da2[6][2][2][2];
    double A_P[6][2][2][2];

    //reshape
    for(i = 0; i < K; i++) {
        for(j = 0; j < channel; j++) {
            da2[i][j][0][0] = dz_o[i][j][0];
        }
    }

    //repelem
    for(i = 0; i < K; i++) {
        for(j = 0; j < channel; j++) {
            da2[i][j][0][1] = da2[i][j][0][0];
            da2[i][j][1][0] = da2[i][j][0][0];
            da2[i][j][1][1] = da2[i][j][0][0];

            A_P[i][j][0][0] = a_p[i][j][0][0];
            A_P[i][j][0][1] = a_p[i][j][0][0];
            A_P[i][j][1][0] = a_p[i][j][0][0];
            A_P[i][j][1][1] = a_p[i][j][0][0];
        }
    }

    for(i = 0; i < K; i++) {
        for(j = 0; j < channel; j++) {
            if(a_c[i][j][0][0] == A_P[i][j][0][0]) dz_p[i][j][0][0] = da2[i][j][0][0];
            else dz_p[i][j][0][0] = 0;

            if(a_c[i][j][0][1] == A_P[i][j][0][1]) dz_p[i][j][0][1] = da2[i][j][0][1];
            else dz_p[i][j][0][1] = 0;

            if(a_c[i][j][1][0] == A_P[i][j][1][0]) dz_p[i][j][1][0] = da2[i][j][1][0];
            else dz_p[i][j][1][0] = 0;

            if(a_c[i][j][1][1] == A_P[i][j][1][1]) dz_p[i][j][1][1] = da2[i][j][1][1];
            else dz_p[i][j][1][1] = 0;
        }
    }
}
/*
int main() {
    int i, j, k, l;
    int line, low, channel, K;
    double a_c[6][2][2][2] = {0.982014, 0.880797, 0.880797, 0.880797, 0.500000, 0.880797, 0.880797, 0.500000, 0.982014, 0.952574, 0.880797, 0.731059,
                              0.500000, 0.731059, 0.880797, 0.731059, 0.982014, 0.880797, 0.880797, 0.952574, 0.500000, 0.880797, 0.880797, 0.268941,
                              0.731059, 0.952574, 0.952574, 0.731059, 0.952574, 0.268941, 0.268941, 0.952574, 0.731059, 0.880797, 0.952574, 0.731059,
                              0.952574, 0.500000, 0.268941, 0.952574, 0.731059, 0.952574, 0.952574, 0.880797, 0.952574, 0.268941, 0.268941, 0.880797};
    int stride = 2;
    double a_p[6][2][1][1] = {0.982014, 0.880797, 0.982014, 0.880797, 0.982014, 0.880797, 0.952574, 0.952574, 0.952574, 0.952574, 0.952574, 0.952574};
    double da2[6][2][1][1];
    double dz_o[6][2][1] = {-0.009117 , 0.104000, -0.009117, 0.104000, -0.009117, 0.104000, 0.003511, -0.007138, 0.003511, -0.007138, 0.003511, -0.007138};
    double dz_p[6][2][2][2];

    K = 6;
    channel = 2;
    low = 1;
    line = 1;

    Pooling_Backprop(a_c, stride, a_p, dz_o, K, channel, dz_p);

    return 0;
}
*/
